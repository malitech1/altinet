{% extends "web/base.html" %}
{% load static %}

{% block title %}Altinet Dashboard{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="{% static 'web/css/home.css' %}" />
{% endblock %}

{% block body_class %}home-page{% endblock %}

{% block content %}
<div class="row g-4 align-items-stretch home-layout">
  <div class="col-12 col-xl-4 col-xxl-3">
    <section class="environment-card bg-white border border-2 border-secondary-subtle rounded-4 shadow-sm h-100 p-3 p-lg-4">
      <div class="d-flex flex-column h-100">
        <header class="mb-4">
          <p class="text-uppercase text-primary fw-semibold small mb-1">Live environment</p>
          <h1 class="h4 fw-semibold mb-0">Your home at a glance</h1>
        </header>
        <div class="mb-4">
          <p id="local-time-display" class="display-6 fw-semibold mb-1">
            {{ environment_snapshot.local_time|date:"g:i A" }}
          </p>
          <p id="local-date-display" class="text-muted mb-0">
            {{ environment_snapshot.local_time|date:"l, F j" }}
          </p>
        </div>
        <div class="environment-metrics row row-cols-1 row-cols-sm-2 g-3">
          <div class="col">
            <article class="environment-metric h-100">
              <h2 class="h6 text-uppercase text-muted mb-2">People present</h2>
              <p class="metric-value mb-0">{{ environment_snapshot.people_present }}</p>
            </article>
          </div>
          <div class="col">
            <article class="environment-metric h-100">
              <h2 class="h6 text-uppercase text-muted mb-2">Occupants</h2>
              {% if environment_snapshot.people_list %}
                <ul class="metric-list mb-0">
                  {% for person in environment_snapshot.people_list %}
                    <li>{{ person }}</li>
                  {% endfor %}
                </ul>
              {% else %}
                <p class="metric-placeholder mb-0">No occupants detected</p>
              {% endif %}
            </article>
          </div>
          <div class="col">
            <article class="environment-metric h-100">
              <h2 class="h6 text-uppercase text-muted mb-2">Outside temperature</h2>
              <p class="metric-value mb-0">
                {% if environment_snapshot.outside_temperature_c is not None %}
                  {{ environment_snapshot.outside_temperature_c|floatformat:1 }}°C
                {% else %}
                  —
                {% endif %}
              </p>
            </article>
          </div>
          <div class="col">
            <article class="environment-metric h-100">
              <h2 class="h6 text-uppercase text-muted mb-2">Average indoor temperature</h2>
              <p class="metric-value mb-0">
                {% if environment_snapshot.average_indoor_temperature_c is not None %}
                  {{ environment_snapshot.average_indoor_temperature_c|floatformat:1 }}°C
                {% else %}
                  —
                {% endif %}
              </p>
            </article>
          </div>
          <div class="col">
            <article class="environment-metric h-100">
              <h2 class="h6 text-uppercase text-muted mb-2">Wind</h2>
              <p class="metric-value mb-0">
                {% if environment_snapshot.wind_speed_kmh is not None %}
                  {{ environment_snapshot.wind_speed_kmh|floatformat:1 }} km/h
                  {% if environment_snapshot.wind_direction_cardinal %}
                    <span class="text-muted">({{ environment_snapshot.wind_direction_cardinal }})</span>
                  {% endif %}
                {% else %}
                  —
                {% endif %}
              </p>
            </article>
          </div>
          <div class="col">
            <article class="environment-metric h-100">
              <h2 class="h6 text-uppercase text-muted mb-2">Local weather</h2>
              <p class="metric-value mb-0">{{ environment_snapshot.weather_summary|default:"—" }}</p>
            </article>
          </div>
        </div>
        <div class="mt-auto pt-4">
          <p class="text-muted small mb-0">
            Data updates automatically as new sensor readings arrive.
          </p>
        </div>
      </div>
    </section>
  </div>
  <div class="col-12 col-xl-8 col-xxl-9">
    <div class="bg-white border border-2 border-secondary-subtle rounded-4 shadow-sm p-3 p-lg-4 h-100">
      <div
        id="home-viewer"
        class="viewer-shell rounded-4 border border-2 border-secondary-subtle position-relative overflow-hidden"
        data-obj-url="{% static 'web/models/home.obj' %}"
      >
        <div class="viewer-overlay d-flex flex-column align-items-center justify-content-center gap-2" data-role="loading">
          <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Loading 3D home model...</span>
          </div>
          <p class="text-muted small mb-0">Loading home model&hellip;</p>
        </div>
        <div class="viewer-overlay d-none text-center p-4" data-role="error">
          <h2 class="h5 fw-semibold mb-2">We couldn't load the home</h2>
          <p class="text-muted mb-0">
            Please refresh the page or check that your browser supports
            WebGL.
          </p>
        </div>
        <noscript>
          <div class="viewer-overlay d-flex flex-column align-items-center justify-content-center gap-2 text-center p-4">
            <h2 class="h5 fw-semibold mb-2">JavaScript required</h2>
            <p class="text-muted mb-0">
              Enable JavaScript to interact with the 3D overview of your home.
            </p>
          </div>
        </noscript>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script type="module" src="{% static 'web/js/home-viewer.js' %}"></script>
<script type="module" src="{% static 'web/js/home-local-time.js' %}"></script>
{% endblock %}
